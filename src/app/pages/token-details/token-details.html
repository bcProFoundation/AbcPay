<ion-header [translucent]="true" class="bp-header">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button icon="chevron-back-outline" defaultHref="/"></ion-back-button>
    </ion-buttons>
    <ion-title>
      <div [reveal-at-scroll-pos]="expandableHeader.headerHeight" [scrollArea]="scrollArea">
        {{ token?.tokenInfo?.name}}
      </div>
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [forceOverscroll]="true" scrollEvents="true" #scrollArea>
  <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)" pullMin="90" pullMax="160">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>
  <div class="wrapper" [ngClass]="{'grid-wrapper': shouldShowZeroState()}">
    <expandable-header [scrollArea]="scrollArea" [fadeFactor]="1" [disableFade]="true" #expandableHeader>
      <ion-toolbar class="wide-header__title">
        <expandable-header-primary class="balance-header">
          <div class="wallet-card" [ngClass]="{ 
            'bg-EAT': token?.tokenInfo?.symbol == 'EAT',
            'bg-bcPro': token?.tokenInfo?.symbol == 'bcPro',
            'bg-Doc': token?.tokenInfo?.symbol == 'Doc',
            'bg-ABCSLP': token?.tokenInfo?.symbol == 'ABCSLP'
            }">
            <div class="wallet-card-header">
              <div class="wallet-icon">
                <div class="icon">
                  <img src="assets/img/currencies/{{token?.tokenInfo?.symbol}}.svg" alt="">
                  <img *ngIf="wallet?.cachedStatus && wallet?.cachedStatus.wallet && wallet?.cachedStatus.wallet?.singleAddress"
                    class="audit" src="assets/img/wallet-details/wallet-audit.svg" alt="">
                </div>
                <div class="wallet-name">
                  <p class="name">{{token?.tokenInfo?.name}}</p>
                  <ion-spinner *ngIf="!wallet.etokenAddress" name="dots"></ion-spinner>
                  <p *ngIf="wallet.etokenAddress" class="wallet-add" copy-to-clipboard="{{ wallet.etokenAddress }}"> {{(wallet.etokenAddress | slice:0:10) +'...'+ (wallet.etokenAddress | slice:-12)}} 
                    <ion-icon name="copy-outline"></ion-icon>
                  </p>
                </div>
              </div>
              <div class="wallet-setting" (click)="openWalletSettings(wallet.id)">
                <img src="assets/img/wallet-details/wallet-setting-{{currentTheme}}.svg" alt="">
              </div>
            </div>
  
            <div class="balance-content">
              <div (tap)="updateAll(true)"
                *ngIf="!wallet?.scanning && (wallet?.cachedStatus || wallet?.lastKnownBalance)">
                <div class="balance-str">
                  <ion-icon class="eye" [name]="wallet?.balanceHidden ? 'eye-outline' : 'eye-off-outline'" (click)="toggleBalance()"></ion-icon>
                  <balance-to-show *ngIf="!wallet?.balanceHidden" [balance]="amountToken"></balance-to-show>
                  <div *ngIf="wallet?.balanceHidden">******</div>
                </div>
              </div>
    
            </div>
          </div>
        
        </expandable-header-primary>
        <expandable-header-footer>

          <div class="action-buttons two-actions" >

            <div class="action-btn receive-btn" (click)="goToTokenInfo()">
              <ion-button expand="block">
                <ion-icon slot="start" name="information-outline"></ion-icon>
                {{ 'Info' | translate }}
              </ion-button>
            </div>
  
            <div class="action-btn send-btn" (click)="goToSendPage()">
              <ion-button expand="block">
                <ion-icon slot="start" name="arrow-up-outline"></ion-icon>
                {{ 'Send' | translate }}
              </ion-button>
            </div>
  
          </div>

          <ion-spinner color="primary" name="crescent" *ngIf="shouldShowSpinner()"></ion-spinner>
        </expandable-header-footer>
      </ion-toolbar>
    </expandable-header>
    <div class="prompt-user activity-fix white-card" *ngIf="shouldShowZeroState()">
      <div class="title-icon larger-icon">
        <img *ngIf="wallet.coin !== 'doge' && wallet.coin !== 'xpi'" src="assets/img/ghost-tongue-out.svg">
        <img *ngIf="wallet.coin === 'xpi'"
          [src]="selectedTheme === 'dark' ? 'assets/img/frog-dark.svg' : 'assets/img/frog-light.svg'">
      </div>
      <div class="title-info">
        <span translate
          *ngIf="!wallet?.credentials.multisigEthInfo && wallet.coin !== 'doge' && wallet.coin !== 'xpi'">It's
          a ghost
          town in here</span>
      </div>
      <div class="subtitle-info">
        <span translate>
          If you have funds stored on a website then you should move them into a secure wallet... like this one!
        </span>
      </div>
    </div>

    <div class="middle-message white-card" *ngIf="updateTxHistoryError" translate>
      Could not update transaction history
    </div>

    <div class="middle-message white-card" *ngIf="updatingTxHistory && (!history[0] || updatingTxHistoryProgress>4)">
      <span translate>Updating transaction history. Please stand by.</span>
      <br>
      <span translate *ngIf="updatingTxHistoryProgress>4">{{updatingTxHistoryProgress}} transactions downloaded</span>
    </div>

    <ng-container *ngIf="history && history[0]">
      <div  class="header-transaction">
        Transaction History
      </div>

      <ion-list class="tx-history">
        <ion-item-group *ngFor="let group of groupedHistory; trackBy: trackByFn; let i = index;">

          <ion-item-divider sticky class="tx-history-header">
            <ion-label>
              <span *ngIf="isDateInCurrentMonth(getDate(group[0].time))">{{ 'Recent' | translate }} </span>
              <span *ngIf="!isDateInCurrentMonth(getDate(group[0].time))">{{getDate(group[0].time) |
                amDateFormat:'MMMM'}}</span>
            </ion-label>
          </ion-item-divider>

          <div class="item-wrapper" *ngFor="let tx of group; trackBy: trackByFn; let i = index">
            <ion-item button detail="false" (click)="itemTapped(tx)" [ngClass]="{'danger-background': tx.hasUnconfirmedInputs || tx.isRBF}">
              <div class="action">
                <div class="amount">
                  <span *ngIf="tx.action == 'received'"
                    [ngClass]="{'received': tx.action == 'received' || tx.action == 'mined' || tx.action == 'immature' , 'sent' : tx.action == 'sent','pending' : tx.confirmations <= 0}">+</span>
                  <span *ngIf="tx.action == 'sent'"
                    [ngClass]="{'received': tx.action == 'received' || tx.action == 'mined' || tx.action == 'immature' , 'sent' : tx.action == 'sent','pending' : tx.confirmations <= 0}">-</span>
                  <span
                    [ngClass]="{'received': tx.action == 'received' || tx.action == 'mined' || tx.action == 'immature', 'sent' : tx.action == 'sent','pending' : tx.confirmations <= 0}">
                    {{tx.amountToken}} {{tx.symbolToken}}</span>
                </div>
                <span class="tx-action"*ngIf="tx.action == 'received'">{{'From: {address}' | translate: {address: tx.outputs[0].address.slice(-8)} }}</span>
                <span class="tx-action" *ngIf="tx.action == 'sent' ">{{'To: {address}' | translate: {address: tx.addressTo.slice(-8)} }}</span>
              </div>

              <ion-note slot="end" class="ion-text-end ion-no-margin ion-no-padding">
                <div class="tx-info">
                  <ng-container *ngIf="tx.confirmations <= 0">
                    <p class="status" *ngIf="tx.action == 'sent' || tx.action == 'received'">{{'Pending'| translate}}</p>
                  </ng-container>
                  <p class="status" *ngIf="tx.isGenesis">Genesis</p>
                  <p class="date" *ngIf="tx.time && createdWithinPastDay(tx.time * 1000)">{{converDate(tx.time * 1000) |
                    amTimeAgo}}</p>
                  <p class="date" *ngIf="tx.time && !createdWithinPastDay(tx.time * 1000)">{{tx.time * 1000 |
                    amDateFormat:'MM/DD/YYYY'}}</p>
                </div>
              </ion-note>

            </ion-item>
          </div>
        </ion-item-group>
      </ion-list>
    </ng-container>

    <ion-infinite-scroll (ionInfinite)="loadHistory($event)" *ngIf="!shouldShowZeroState()">
      <ion-infinite-scroll-content></ion-infinite-scroll-content>
    </ion-infinite-scroll>
  </div>
</ion-content>