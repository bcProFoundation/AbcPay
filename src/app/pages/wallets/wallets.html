<ion-menu side="start" menuId="first" contentId="main-content">
  <ion-header>
    <ion-toolbar translucent>
      <ion-button class="back-btn" fill="clear" slot="start" (click)="closeMenu()">
        <ion-icon name="chevron-back"></ion-icon>
      </ion-button>
      <ion-title>{{'Your keys' | translate}}</ion-title>
    </ion-toolbar>
  </ion-header>
  <ion-content>
    <ion-list lines="none">
      <ion-reorder-group disabled={{showReorder}} (ionItemReorder)="reorderAccounts($event)">
        <ion-item *ngFor="let walletGroup of walletsGroups" (click)="getKeySelected(walletGroup[0]?.keyId)">
          <ion-icon [style]="keySelected[0]?.keyId === walletGroup[0]?.keyId ? '' : 'color: transparent;'"
            name="checkmark-circle" slot="start"></ion-icon>
          <ion-label>{{ getWalletGroup(walletGroup[0]?.keyId).name }}</ion-label>
          <ion-buttons slot="end">
            <ion-button>
              <ion-icon src="assets/img/key-edit-{{currentTheme}}.svg"></ion-icon>
            </ion-button>
            <ion-reorder>
              <ion-button (click)="closeMenu()">
                <ion-icon src="assets/img/key-drag-{{currentTheme}}.svg"></ion-icon>
              </ion-button>
            </ion-reorder>
          </ion-buttons>
        </ion-item>
      </ion-reorder-group>
    </ion-list>
  </ion-content>
  <ion-footer class="ion-no-border">
    <ion-toolbar>
      <ion-button class="key-import" fill=clear (click)="addKey()">
        {{'Create or Import a Key' | translate}}
      </ion-button>
    </ion-toolbar>
  </ion-footer>
</ion-menu>

<div class="ion-page" id="main-content">
  <ion-header *ngIf="!(!walletsGroups || !walletsGroups[0])" [translucent]="true" class="bp-header">
    <ion-toolbar>
      <ion-buttons slot="start" class="ion-no-margin">
        <ion-button class="key-setting" (click)="openSettingPage()">
          <ion-icon slot="icon-only" src="assets/img/key-setting-{{currentTheme}}.svg"></ion-icon>
        </ion-button>
        <ion-button class="key-list" (click)="openMenu()">
          <ion-icon slot="icon-only" src="assets/img/key-list-{{currentTheme}}.svg"></ion-icon>
        </ion-button>
      </ion-buttons>
      <ion-title class="key-title">
        {{ keyNameSelected }}
      </ion-title>
      <ion-buttons slot="end" class="settings-button" *ngIf="walletsGroups && walletsGroups[0]">
        <ion-button class="key-add" (click)="openAddressBookPage()">
          <ion-icon class="address-book" src="assets/img/key-addressbook.svg"></ion-icon>
        </ion-button>
        <ion-button slot="icon-only" class="key-notifications" (click)="openProposalsNotificationsPage()">
          <img *ngIf="txpsN > 0" class="custom-notification-icon" src="assets/img/wallet-details/notification-{{currentTheme}}.svg" />
          <ion-icon src="assets/img/key-notifications-{{currentTheme}}.svg"></ion-icon>
        </ion-button>
      </ion-buttons>
    </ion-toolbar>
  </ion-header>

  <ion-content>
    <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)" pullMin="90" pullMax="160">
      <ion-refresher-content></ion-refresher-content>
    </ion-refresher>
    <div class="wrapper">
      <div *ngIf="!(!walletsGroups || !walletsGroups[0])" class="balance">
        <div class="balance-str" [style]="!isShowBalance ? 'align-items: baseline' : 'align-items: center'">
          <ion-icon class="eye" [name]="!isShowBalance ? 'eye-outline' : 'eye-off-outline'"
            (click)="isShowBalance = !isShowBalance"></ion-icon>
          <span class="balance-alt-str">
            {{isShowBalance ? totalBalanceKey : '******'}}
          </span>
          <span *ngIf="isShowBalance" class="unit">
            {{currentCurrency}}
          </span>
        </div>
        <ion-button fill=clear (click)="addWallet(keySelected[0]?.keyId)">
          {{'Create a new account' | translate}}
        </ion-button>
      </div>

      <div class="wallets-container">
        <div *ngIf="!(!walletsGroups || !walletsGroups[0])" class="header-title">
          {{'Accounts' | translate}}
        </div>
        <div class="section-header ion-padding-top ion-padding-bottom" *ngIf="keySelected[0]?.keyId == 'read-only'">
          <ion-icon src="assets/img/settings-icons/icon-read-only.svg" width="20" class="item-img" slot="start">
          </ion-icon>
          <ion-label class="key-name">
            <span translate>Read Only Wallets</span>
          </ion-label>
        </div>
        <ion-list lines="nones" class="bp-list">
          <div class="wallet-item" *ngFor="let wallet of keySelected; let j = index">
            <wallet-item-content [isKeyTab]="true" [wallet]="wallet" [isShowBalance]="isShowBalance"
              (click)="goToWalletDetails(wallet)">
            </wallet-item-content>

            <ng-container *ngIf="isSupportToken(wallet)">
              <div class="token-container">
                <div class="section-header ion-padding-top ion-padding-bottom"
                  [ngClass]="{'no-border': isCollapsedToken(wallet.id)}">
                  <div class="wrap-key-token">
                    <ion-label class="key-name">
                      <span>eToken</span>
                    </ion-label>
                    <div class="collapse">
                      <div class="collapse-btn" (click)="collapsToken(wallet.id)">
                        <ion-icon *ngIf="!isCollapsedToken(wallet.id)" name="chevron-up-outline"></ion-icon>
                        <ion-icon *ngIf="isCollapsedToken(wallet.id)" name="chevron-down-outline"></ion-icon>
                      </div>
                    </div>
                  </div>
                  <div class="address-token" copy-to-clipboard="{{wallet.etokenAddress}}">
                    <span class="background-content">{{wallet.etokenAddress | slice:-8}}</span>
                    <ion-icon class="coin-img" name="copy-outline"></ion-icon>
                  </div>
                </div>
                <ng-container *ngIf="!wallet.tokens">
                  <div class="no-token" [ngClass]="{ collapsed: isCollapsedToken(wallet.id) }">No token available yet!
                  </div>
                </ng-container>
                <ng-container *ngIf="wallet.tokens">
                  <ion-list class="token-item bp-list" [ngClass]="{ collapsed: isCollapsedToken(wallet.id) }">
                    <ion-item *ngFor="let token of wallet.tokens" (click)="goToTokenDetails(wallet, token)">
                      <img class="item-img rectangle token-icon" [src]="setIconToken(token)" slot="start">
                      <ion-label>
                        <div class="main-label">{{token?.tokenInfo?.name}}</div>
                        <div class="secondary-label" *ngIf="wallet?.cachedStatus">
                          {{token?.tokenInfo?.symbol}}
                        </div>
                      </ion-label>
                      <ion-note slot="end">
                        <div>
                          <div *ngIf="!wallet?.balanceHidden" class="main-note">
                            {{DecimalFormatBalance(token?.amountToken)}}</div>
                          <div *ngIf="wallet?.balanceHidden" class="main-note">******</div>
                        </div>
                      </ion-note>
                    </ion-item>
                  </ion-list>
                </ng-container>
              </div>
            </ng-container>

          </div>
        </ion-list>
        <label-tip type="warn" class="ion-margin-top"
          *ngIf="keySelected && keySelected[0] && keySelected[0]?.needsBackup" header="no-header">
          <div label-tip-body>
            <span translate>Before retrieving your wallets addresses, it's recommended that you first write down your
              recovery phrase and store it securely so that your wallets can be recovered in the case your device was
              lost
              or stolen.</span>
            <br>
            <a class="label-tip-link" (click)="openBackupPage(keySelected[0]?.keyId)" translate>Backup now</a>
          </div>
        </label-tip>
      </div>
      <ng-container *ngIf="!isDonation;else donation">
        <create-new-wallet *ngIf="!walletsGroups || !walletsGroups[0]"></create-new-wallet>
      </ng-container>
      <ng-template #donation>
        <div *ngIf="isShowCreateNewWallet">
          <create-new-wallet></create-new-wallet>
        </div>
      </ng-template>
    </div>
  </ion-content>
</div>